using NetTopologySuite.Geometries;
using NetTopologySuite.Operation.Union;
using NUnit.Framework;

namespace NetTopologySuite.Tests.NUnit.Operation.Union
{
    [TestFixture]
    public class UnaryUnionTest
    {
        GeometryFactory geomFact = new GeometryFactory();

        [Test]
        public void TestEmptyCollection()
        {
            DoTest(new string[] { }, "GEOMETRYCOLLECTION EMPTY");
        }

        [Test]
        public void TestPoints()
        {
            DoTest(new [] { "POINT (1 1)", "POINT (2 2)" }, "MULTIPOINT ((1 1), (2 2))");
        }
        [Test]
        public void TestLineNoding()
        {
            DoTest(new []{ "LINESTRING (0 0, 10 0, 5 -5, 5 5)"},
                           "MULTILINESTRING ((0 0, 5 0), (5 0, 10 0, 5 -5, 5 0), (5 0, 5 5))");
        }

        [TestAttribute, Category("Issue326")]
        public void TestSnapIfNeeded()
        {
            DoTest(new[] { "LINESTRING (-79.52286 8.89081, -79.57426 8.9547, -79.57421 8.95472, -79.57424 8.9547, -79.57429 8.9547, -79.57425 8.95469, -79.57429 8.95472, -79.57431 8.95472, -79.57424 8.95473, -79.57422 8.95478, -79.57424 8.95474, -79.57421 8.9547, -79.57426 8.95473, -79.57434 8.95472, -79.5742 8.95469, -79.57428 8.95474, -79.57433 8.95474, -79.57426 8.95471, -79.57419 8.95469, -79.57433 8.95479, -79.57426 8.95466, -79.57425 8.95476, -79.5743 8.95469, -79.57424 8.95469, -79.5742 8.95476, -79.57424 8.95465, -79.57423 8.95474, -79.57423 8.95471)" },
                           "MULTILINESTRING ((-79.52286 8.89081, -79.574233703956338 8.9546673141200621), (-79.574233703956338 8.9546673141200621, -79.5742375456324 8.9546720893084473), (-79.5742375456324 8.9546720893084473, -79.574251954922516 8.95469), (-79.574251954922516 8.95469, -79.5742524471003 8.9546906117750744), (-79.5742524471003 8.9546906117750744, -79.574254928966042 8.9546936967245223), (-79.574254928966042 8.9546936967245223, -79.574256442229483 8.9546955777051043), (-79.574256442229483 8.9546955777051043, -79.57426 8.9547), (-79.57426 8.9547, -79.574255833333339 8.954701666666665), (-79.574255833333339 8.954701666666665, -79.574255348837212 8.9547018604651143), (-79.574255348837212 8.9547018604651143, -79.574245416666656 8.9547058333333336), (-79.574245416666656 8.9547058333333336, -79.574233255813951 8.9547106976744164), (-79.574233255813951 8.9547106976744164, -79.5742331707317 8.9547107317073156), (-79.5742331707317 8.9547107317073156, -79.57423 8.9547119999999989), (-79.57423 8.9547119999999989, -79.57423 8.954712), (-79.57423 8.954712, -79.574226666666675 8.9547133333333289), (-79.574226666666675 8.9547133333333289, -79.5742241025641 8.954714358974357), (-79.5742241025641 8.954714358974357, -79.574221538461529 8.9547153846153833), (-79.574221538461529 8.9547153846153833, -79.574215319148948 8.95471787234042), (-79.574215319148948 8.95471787234042, -79.57421 8.95472, -79.574216 8.9547159999999923), (-79.574216 8.9547159999999923, -79.57422 8.9547133333333342), (-79.57422 8.9547133333333342, -79.574221379310345 8.9547124137931018), (-79.574221379310345 8.9547124137931018, -79.574225789473687 8.954709473684213), (-79.574225789473687 8.954709473684213, -79.574228387096781 8.9547077419354828), (-79.574228387096781 8.9547077419354828, -79.57423076923078 8.9547061538461517), (-79.57423076923078 8.9547061538461517, -79.574234 8.9547040000000013), (-79.574234 8.9547040000000013, -79.5742355 8.954703), (-79.5742355 8.954703, -79.57424 8.9547, -79.574246666666681 8.9547), (-79.574246666666681 8.9547, -79.574256 8.9547), (-79.574256 8.9547, -79.57426 8.9547), (-79.57426 8.9547, -79.574263333333334 8.9547), (-79.574263333333334 8.9547, -79.574281538461534 8.9547), (-79.574281538461534 8.9547, -79.57429 8.9547, -79.574280222222214 8.954697555555553), (-79.574280222222214 8.954697555555553, -79.5742568292683 8.9546917073170711), (-79.5742568292683 8.9546917073170711, -79.5742524471003 8.9546906117750744), (-79.5742524471003 8.9546906117750744, -79.57425 8.95469), (-79.57425 8.95469, -79.574254928966042 8.9546936967245223), (-79.574254928966042 8.9546936967245223, -79.574256511627908 8.9546948837209257), (-79.574256511627908 8.9546948837209257, -79.574263333333334 8.9547), (-79.574263333333334 8.9547, -79.574270000000013 8.954705), (-79.574270000000013 8.954705, -79.574282558139529 8.954714418604647), (-79.574282558139529 8.954714418604647, -79.57429 8.95472, -79.5742923076923 8.95472), (-79.5742923076923 8.95472, -79.57431 8.95472, -79.574293571428569 8.9547223469387749), (-79.574293571428569 8.9547223469387749, -79.57429 8.9547228571428565), (-79.57429 8.9547228571428565, -79.574275 8.954725), (-79.574275 8.954725, -79.574259534883723 8.9547272093023249), (-79.574259534883723 8.9547272093023249, -79.57425615384615 8.9547276923076922), (-79.57425615384615 8.9547276923076922, -79.5742531884058 8.9547281159420287), (-79.5742531884058 8.9547281159420287, -79.574245 8.9547292857142846), (-79.574245 8.9547292857142846, -79.57424 8.95473, -79.574237391304351 8.95473652173913), (-79.574237391304351 8.95473652173913, -79.57422 8.95478, -79.57424 8.95474, -79.574237391304351 8.95473652173913), (-79.574237391304351 8.95473652173913, -79.574231290322587 8.9547283870967735), (-79.574231290322587 8.9547283870967735, -79.57423 8.9547266666666658), (-79.57423 8.9547266666666658, -79.574223783783779 8.9547183783783826), (-79.574223783783779 8.9547183783783826, -79.574221538461529 8.9547153846153833), (-79.574221538461529 8.9547153846153833, -79.57422 8.9547133333333342), (-79.57422 8.9547133333333342, -79.57421795918367 8.9547106122449058), (-79.57421795918367 8.9547106122449058, -79.5742169230769 8.95470923076922), (-79.5742169230769 8.95470923076922, -79.57421 8.9547, -79.574219701492538 8.9547058208955281), (-79.574219701492538 8.9547058208955281, -79.574225789473687 8.954709473684213), (-79.574225789473687 8.954709473684213, -79.574228085106384 8.9547108510638349), (-79.574228085106384 8.9547108510638349, -79.57423 8.954712), (-79.57423 8.954712, -79.57423 8.9547120000000042), (-79.57423 8.9547120000000042, -79.574232916666674 8.9547137500000034), (-79.574232916666674 8.9547137500000034, -79.57425339622641 8.9547260377358526), (-79.57425339622641 8.9547260377358526, -79.57425615384615 8.9547276923076922), (-79.57425615384615 8.9547276923076922, -79.57426 8.95473, -79.574263333333334 8.9547295833333322), (-79.574263333333334 8.9547295833333322, -79.574272549019611 8.9547284313725477), (-79.574272549019611 8.9547284313725477, -79.574295315315311 8.9547255855855852), (-79.574295315315311 8.9547255855855852, -79.574296129032263 8.954725483870968), (-79.574296129032263 8.954725483870968, -79.57434 8.95472, -79.574286725663711 8.9547085840707954), (-79.574286725663711 8.9547085840707954, -79.574286086956519 8.9547084472049665), (-79.574286086956519 8.9547084472049665, -79.574270000000013 8.954705), (-79.574270000000013 8.954705, -79.5742558041958 8.9547019580419569), (-79.5742558041958 8.9547019580419569, -79.574255348837212 8.9547018604651143), (-79.574255348837212 8.9547018604651143, -79.574246666666681 8.9547), (-79.574246666666681 8.9547, -79.574235636363639 8.954697636363635), (-79.574235636363639 8.954697636363635, -79.574234728682171 8.9546974418604641), (-79.574234728682171 8.9546974418604641, -79.574223614457836 8.9546950602409634), (-79.574223614457836 8.9546950602409634, -79.5742 8.95469, -79.574208421052646 8.9546952631578964), (-79.574208421052646 8.9546952631578964, -79.574220740740742 8.954702962962962), (-79.574220740740742 8.954702962962962, -79.574228387096781 8.9547077419354828), (-79.574228387096781 8.9547077419354828, -79.574229473684213 8.9547084210526311), (-79.574229473684213 8.9547084210526311, -79.5742331707317 8.9547107317073156), (-79.5742331707317 8.9547107317073156, -79.574233246753252 8.9547107792207772), (-79.574233246753252 8.9547107792207772, -79.574253647058825 8.9547235294117637), (-79.574253647058825 8.9547235294117637, -79.574259534883723 8.9547272093023249), (-79.574259534883723 8.9547272093023249, -79.574263333333334 8.9547295833333322), (-79.574263333333334 8.9547295833333322, -79.574269135802467 8.954733209876542), (-79.574269135802467 8.954733209876542, -79.57428 8.95474, -79.574303076923073 8.95474), (-79.574303076923073 8.95474, -79.57433 8.95474, -79.574296129032263 8.954725483870968), (-79.574296129032263 8.954725483870968, -79.574295 8.954725), (-79.574295 8.954725, -79.57429 8.9547228571428565), (-79.57429 8.9547228571428565, -79.5742796875 8.9547184375), (-79.5742796875 8.9547184375, -79.57426 8.95471, -79.574255138888887 8.954708611111112), (-79.574255138888887 8.954708611111112, -79.574245416666656 8.9547058333333336), (-79.574245416666656 8.9547058333333336, -79.5742355 8.954703), (-79.5742355 8.954703, -79.574234153846149 8.9547026153846172), (-79.574234153846149 8.9547026153846172, -79.574232982456138 8.9547022807017562), (-79.574232982456138 8.9547022807017562, -79.574222117647068 8.954699176470589), (-79.574222117647068 8.954699176470589, -79.574208421052646 8.9546952631578964), (-79.574208421052646 8.9546952631578964, -79.57419 8.95469, -79.5742169230769 8.95470923076922), (-79.5742169230769 8.95470923076922, -79.5742181443299 8.9547101030927845), (-79.5742181443299 8.9547101030927845, -79.574221379310345 8.9547124137931018), (-79.574221379310345 8.9547124137931018, -79.5742241025641 8.954714358974357), (-79.5742241025641 8.954714358974357, -79.574225507246382 8.95471536231884), (-79.574225507246382 8.95471536231884, -79.57423 8.95471857142857), (-79.57423 8.95471857142857, -79.574232205882353 8.954720147058822), (-79.574232205882353 8.954720147058822, -79.574245 8.9547292857142846), (-79.574245 8.9547292857142846, -79.574252533333336 8.954734666666667), (-79.574252533333336 8.954734666666667, -79.574262837837836 8.9547420270270273), (-79.574262837837836 8.9547420270270273, -79.57433 8.95479, -79.574303076923073 8.95474), (-79.574303076923073 8.95474, -79.574295315315311 8.9547255855855852), (-79.574295315315311 8.9547255855855852, -79.574295 8.954725), (-79.574295 8.954725, -79.574293571428569 8.9547223469387749), (-79.574293571428569 8.9547223469387749, -79.5742923076923 8.95472), (-79.5742923076923 8.95472, -79.574286403508765 8.9547090350877188), (-79.574286403508765 8.9547090350877188, -79.574286086956519 8.9547084472049665), (-79.574286086956519 8.9547084472049665, -79.574281538461534 8.9547), (-79.574281538461534 8.9547, -79.574280222222214 8.954697555555553), (-79.574280222222214 8.954697555555553, -79.574276153846156 8.95469), (-79.574276153846156 8.95469, -79.57426 8.95466, -79.574257 8.95469), (-79.574257 8.95469, -79.5742568292683 8.9546917073170711), (-79.5742568292683 8.9546917073170711, -79.574256511627908 8.9546948837209257), (-79.574256511627908 8.9546948837209257, -79.574256442229483 8.9546955777051043), (-79.574256442229483 8.9546955777051043, -79.574256 8.9547), (-79.574256 8.9547, -79.574255833333339 8.954701666666665), (-79.574255833333339 8.954701666666665, -79.5742558041958 8.9547019580419569), (-79.5742558041958 8.9547019580419569, -79.574255138888887 8.954708611111112), (-79.574255138888887 8.954708611111112, -79.574253647058825 8.9547235294117637), (-79.574253647058825 8.9547235294117637, -79.57425339622641 8.9547260377358526), (-79.57425339622641 8.9547260377358526, -79.5742531884058 8.9547281159420287), (-79.5742531884058 8.9547281159420287, -79.574252533333336 8.954734666666667), (-79.574252533333336 8.954734666666667, -79.57425 8.95476, -79.574262837837836 8.9547420270270273), (-79.574262837837836 8.9547420270270273, -79.574269135802467 8.954733209876542), (-79.574269135802467 8.954733209876542, -79.574272549019611 8.9547284313725477), (-79.574272549019611 8.9547284313725477, -79.574275 8.954725), (-79.574275 8.954725, -79.5742796875 8.9547184375), (-79.5742796875 8.9547184375, -79.574282558139529 8.954714418604647), (-79.574282558139529 8.954714418604647, -79.574286403508765 8.9547090350877188), (-79.574286403508765 8.9547090350877188, -79.574286725663711 8.9547085840707954), (-79.574286725663711 8.9547085840707954, -79.5743 8.95469, -79.574276153846156 8.95469), (-79.574276153846156 8.95469, -79.574257 8.95469), (-79.574257 8.95469, -79.574251954922516 8.95469), (-79.574251954922516 8.95469, -79.57425 8.95469), (-79.57425 8.95469, -79.57424 8.95469, -79.574235636363639 8.954697636363635), (-79.574235636363639 8.954697636363635, -79.574234482758627 8.9546996551724174), (-79.574234482758627 8.9546996551724174, -79.574232982456138 8.9547022807017562), (-79.574232982456138 8.9547022807017562, -79.57423076923078 8.9547061538461517), (-79.57423076923078 8.9547061538461517, -79.574229473684213 8.9547084210526311), (-79.574229473684213 8.9547084210526311, -79.574228085106384 8.9547108510638349), (-79.574228085106384 8.9547108510638349, -79.574226666666675 8.9547133333333289), (-79.574226666666675 8.9547133333333289, -79.574225507246382 8.95471536231884), (-79.574225507246382 8.95471536231884, -79.574223783783779 8.9547183783783826), (-79.574223783783779 8.9547183783783826, -79.5742 8.95476, -79.574215319148948 8.95471787234042), (-79.574215319148948 8.95471787234042, -79.574216 8.9547159999999923), (-79.574216 8.9547159999999923, -79.57421795918367 8.9547106122449058), (-79.57421795918367 8.9547106122449058, -79.5742181443299 8.9547101030927845), (-79.5742181443299 8.9547101030927845, -79.574219701492538 8.9547058208955281), (-79.574219701492538 8.9547058208955281, -79.574220740740742 8.954702962962962), (-79.574220740740742 8.954702962962962, -79.574222117647068 8.954699176470589), (-79.574222117647068 8.954699176470589, -79.574223614457836 8.9546950602409634), (-79.574223614457836 8.9546950602409634, -79.574233703956338 8.9546673141200621), (-79.574233703956338 8.9546673141200621, -79.57424 8.95465, -79.5742375456324 8.9546720893084473), (-79.5742375456324 8.9546720893084473, -79.574234728682171 8.9546974418604641), (-79.574234728682171 8.9546974418604641, -79.574234482758627 8.9546996551724174), (-79.574234482758627 8.9546996551724174, -79.574234153846149 8.9547026153846172), (-79.574234153846149 8.9547026153846172, -79.574234 8.9547040000000013), (-79.574234 8.9547040000000013, -79.574233255813951 8.9547106976744164), (-79.574233255813951 8.9547106976744164, -79.574233246753252 8.9547107792207772), (-79.574233246753252 8.9547107792207772, -79.574232916666674 8.9547137500000034), (-79.574232916666674 8.9547137500000034, -79.574232205882353 8.954720147058822), (-79.574232205882353 8.954720147058822, -79.574231290322587 8.9547283870967735), (-79.574231290322587 8.9547283870967735, -79.57423 8.95474, -79.57423 8.9547266666666658), (-79.57423 8.9547266666666658, -79.57423 8.95471857142857), (-79.57423 8.95471857142857, -79.57423 8.9547120000000042), (-79.57423 8.9547120000000042, -79.57423 8.9547119999999989), (-79.57423 8.9547119999999989, -79.57423 8.95471))");
        }

        [Test]
        public void TestAll()
        {
            DoTest(new[] { "GEOMETRYCOLLECTION (POLYGON ((0 0, 0 90, 90 90, 90 0, 0 0)),   POLYGON ((120 0, 120 90, 210 90, 210 0, 120 0)),  LINESTRING (40 50, 40 140),  LINESTRING (160 50, 160 140),  POINT (60 50),  POINT (60 140),  POINT (40 140))" },
                "GEOMETRYCOLLECTION (POINT (60 140),   LINESTRING (40 90, 40 140), LINESTRING (160 90, 160 140), POLYGON ((0 0, 0 90, 40 90, 90 90, 90 0, 0 0)), POLYGON ((120 0, 120 90, 160 90, 210 90, 210 0, 120 0)))");
        }

        private void DoTest(string[] inputWKT, string expectedWKT)
        {
            Geometry result;
            var geoms = GeometryUtils.ReadWKT(inputWKT);
            if (geoms.Count == 0)
            {
                result = UnaryUnionOp.Union(geoms, geomFact);
            }
            else
            {
                result = UnaryUnionOp.Union(geoms);
            }

            Assert.IsTrue(GeometryUtils.IsEqual(GeometryUtils.ReadWKT(expectedWKT), result));
        }
    }
}
